

typedef unsigned int uint32_t;
typedef unsigned short int uint16_t;
typedef unsigned char uint8_t;	


void SystemClock_Config()
{	
	//启动HSE
	*(uint32_t *)0x40021000 |= 0x01 << 16;
	
	//等待HSE稳定就绪
	while((*(uint32_t *)0x40021000 & 0x02) == 0)
	{
	}
	
	//关闭PLL
	*(uint32_t *)0x40021000 &= ~(0x01 << 24);
	while(((*(uint32_t *)0x40021000 & 0x01 << 25)) == 1 )
	{
	}
	
	//选择HSE作为PLL的时钟输入源

	*(uint32_t *)0x40021004 &= ~((0x01 << 18) | (0x01 << 19) | (0x01 << 20) | (0x01 << 21));		//清除PLL倍频因子
	*(uint32_t *)0x40021004 |= 	((0x01 << 18) | (0x01 << 19) | (0x01 << 20)); 									//PLL 9倍频输出
	
	//使能PLL
	*(uint32_t *)0x40021000 |= 	(0x01 << 24);
	
	//等待PLL稳定就绪
	while((*(uint32_t *)0x40021000 & 0x01 << 25) == 0 )
	{
	}
		
	//切换系统时钟源到PLL
	*(uint32_t *)0x40021004 &= ~(0x03); 		//清除SW位
	*(uint32_t *)0x40021004 |= (0x02);			//切换系统时钟源为PLL
	
	//等待PLL作为系统时钟源生效
	while(((*(uint32_t *)0x40021004 & (0x01 << 2)) == 0) && ((*(uint32_t *)0x40021004 & (0x01 << 3)) == 1))
	{
	}
	
	//设置AHB不分频
	*(uint32_t *)0x40021004 &= ~(0x01 << 7); 
	
	//设置APB1 2分频
	*(uint32_t *)0x40021004 &= (~((0x01) << 8) | ~((0x01) << 9)); 
	*(uint32_t *)0x40021004 |= (0x01 << 10); 
	
	//设置APB2 不分频
	*(uint32_t *)0x40021004 &= ~(0x01 << 13);
}



void TIM1_PA8_PWM_Init()
{
	//使能GPIOA时钟
	*(uint32_t *)0x40021018 |= (0x01 << 2);
	
	//使能TIM1定时器时钟
	*(uint32_t *)0x40021018 |= (0x01 << 11);
	
	//配置PA8为复用推挽输出模式	
	*(uint32_t *)0x40010804 &= (~(0x01) | ~((0x01) << 1) | ~((0x01) << 2) | ~((0x01) << 3));  	//清除PA8位 
	*(uint32_t *)0x40010804 |= (0x03 | 0x01 << 3);
	*(uint32_t *)0x40010804 &= ~(0x01 << 2); 		//配置PA8为复用推挽输出 50MHz
	
	//配置TIM1通道1为PWM模式
	*(uint32_t *)0x40012C00 &= (~(0x01 << 8) | ~(0x01 << 9));			//使用内部时钟
	*(uint32_t *)0x40012C28 = 7199; 		//设置预分频为 7199
	*(uint32_t *)0x40012C2C = 199;			//设置自动重装值为199
	*(uint32_t *)0x40012C34 = 100;			//设置CCR的值为 100
	*(uint32_t *)0x40012C18 |= (0x03 << 5);
	*(uint32_t *)0x40012C18 &= ~(0x01 << 4);			//设置为PWM模式1
	
	//使能输出
	*(uint32_t *)0x40012C20 |= 0x01;
	
	//启动定时器
	*(uint32_t *)0x40012C00 |= 0x01;
	
	//等待定时器稳定
	while(((*(uint32_t *)0x40012C10) & (0x01)) == 0)
	{
	}		
	*(uint32_t *)0x40012C10 &= ~0x01;

}

void GPIO_PC13_Init()
{
	*(uint32_t *)0x40021018 |= 0x01 << 4;
	*(uint32_t *)0x40011004 &= ~(0x03 << 22);
	*(uint32_t *)0x40011004 |= (0x03 << 20);
}	


int main()
{
	SystemClock_Config();
	GPIO_PC13_Init();
	TIM1_PA8_PWM_Init();
	
		*(uint32_t *)0x40012C34 = 200;	
}



//void SystemClock_Config()
//{
//    // 使能 HSE
//    *(uint32_t *)0x40021000 |= 0x01 << 16;

//    // 等待 HSE 就绪
//    while((*(uint32_t *)0x40021000 & 0x02) == 0);

//    // 关闭 PLL
//    *(uint32_t *)0x40021000 &= ~(0x01 << 24);
//    while(((*(uint32_t *)0x40021000 & 0x01 << 25)) == 1);

//    // 配置 PLL 源和倍频系数
//    *(uint32_t *)0x40021004 &= ~((0x01 << 18) | (0x01 << 19) | (0x01 << 20) | (0x01 << 21));
//    *(uint32_t *)0x40021004 |= ((0x01 << 18) | (0x01 << 19) | (0x01 << 20));

//    // 使能 PLL
//    *(uint32_t *)0x40021000 |= (0x01 << 24);
//    while((*(uint32_t *)0x40021000 & 0x01 << 25) == 0);

//    // 选择 PLL 作为系统时钟
//    *(uint32_t *)0x40021004 &= ~(0x03);
//    *(uint32_t *)0x40021004 |= (0x02);
//    while(((*(uint32_t *)0x40021004 & (0x01 << 2)) == 0) && ((*(uint32_t *)0x40021004 & (0x01 << 3)) == 1));

//    // 配置总线预分频器
//    *(uint32_t *)0x40021004 &= ~(0x01 << 7);

//    // 配置 APB1 和 APB2 预分频器
//    *(uint32_t *)0x40021004 &= (~((0x01) << 8) | ~((0x01) << 9));
//    *(uint32_t *)0x40021004 |= (0x01 << 10);

//    // 配置闪存等待状态
//    *(uint32_t *)0x40021004 &= ~(0x01 << 13);
//}



//void TIM1_PA8_PWM_Init()
//{
//    // 使能 TIM1 和 GPIOA 时钟
//    *(uint32_t *)0x40021018 |= (0x01 << 2);
//    *(uint32_t *)0x40021018 |= (0x01 << 11);

//    // 配置 PA8 复用功能
//    *(uint32_t *)0x40010804 &= (~(0x01) | ~((0x01) << 1) | ~((0x01) << 2) | ~((0x01) << 3));
//    *(uint32_t *)0x40010804 |= (0x03 | 0x01 << 3);
//    *(uint32_t *)0x40010804 &= ~(0x01 << 2);

//    // 配置 TIM1
//    *(uint32_t *)0x40012C00 &= (~(0x01 << 8) | ~(0x01 << 9));
//    *(uint32_t *)0x40012C28 = 7199;       // 预分频器
//    *(uint32_t *)0x40012C2C = 199;        // 自动重装载值
//    *(uint32_t *)0x40012C34 = 100;        // 比较值
//    *(uint32_t *)0x40012C18 |= (0x03 << 5);
//    *(uint32_t *)0x40012C18 &= ~(0x01 << 4);

//    // 使能 TIM1
//    *(uint32_t *)0x40012C20 |= 0x01;
//    *(uint32_t *)0x40012C00 |= 0x01;

//    // 等待更新事件标志置位
//    while(((*(uint32_t *)0x40012C10) & (0x01)) == 0);
//    *(uint32_t *)0x40012C10 &= ~0x01;
//}



//void GPIO_PC13_Init()
//{
//    *(uint32_t *)0x40021018 |= 0x01 << 4;
//    *(uint32_t *)0x40011004 &= ~(0x03 << 22);
//    *(uint32_t *)0x40011004 |= (0x03 << 20);
//}


//int main()
//{
//    SystemClock_Config();
//    GPIO_PC13_Init();
//    TIM1_PA8_PWM_Init();

//    while (1)
//    {
//        // 保持主循环运行，确保 PWM 输出
//    }
//}
